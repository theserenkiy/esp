<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Vectorizer</title>

<script>
const cl = console.log;

let idata_t, idata_s, sgs = [];

function putPixel(i)
{
	idata_t.data[i*4] = 255;//sgs[i];
	idata_t.data[i*4+1] = 0;//sgs[i];
	idata_t.data[i*4+2] = 0;//sgs[i];
	idata_t.data[i*4+3] = 255;
}

window.onload = async () => {
	sctx = document.getElementById('source').getContext('2d');
	tctx = document.getElementById('target').getContext('2d');
	let im = new Image();
	

	await new Promise(s => {
		im.onload = s;
		im.src = "/vect.png";
	})
	
	sctx.drawImage(im,0,0);

	idata_s = sctx.getImageData(0,0,320,240);
	idata_t = tctx.getImageData(0,0,320,240);

	let sdata = idata_s.data;
	for(let i=0; i < sdata.length; i+=4)
	{
		sgs.push((sdata[i]+sdata[i+1]+sdata[i+1])/3);
	}

	cl(sgs)

	let avga = [127,127,127,127,127,127,127,127];
	let avgp = 0;
	for(let i=0; i < sgs.length; i++)
	{
		avg = avga.reduce((a,v)=> a+v,0)/8;
		avga[(avgp++)%8] = sgs[i];

		if(Math.abs(sgs[i]-avg) > 10)
			putPixel(i);
	}

	//cl(idata_t.data)
	tctx.putImageData(idata_t,0,0);
}

</script>
<style>
canvas {border: 1px solid #aaa}
</style>
</head>
<body>
	<canvas width="320" height="240" id="source"></canvas>
	<canvas width="320" height="240" id="target"></canvas>
</body>
</html>